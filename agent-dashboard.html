<!DOCTYPE html>

<html lang="en">
<head>
<script async="" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2493026919792043"></script>
<meta charset="utf-8"/>
<title>Agent Dashboard</title>
<!-- Stylesheets -->
<link href="css/bootstrap.min.css" rel="stylesheet"/>
<link href="css/style.css" rel="stylesheet"/>
<link href="css/fontawesome.css" rel="stylesheet"/>
<!-- Dark Mode Stylesheet -->
<link disabled="" href="css/style-dark.css" id="dark-theme-style" rel="stylesheet"/>
<link href="images/favicon-16x16.png" rel="shortcut icon" type="image/x-icon"/>
<link href="images/favicon-16x16.png" rel="icon" type="image/x-icon"/>
<!-- Responsive -->
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
<!--[if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script><![endif]-->
<!--[if lt IE 9]><script src="js/respond.js"></script><![endif]-->
<!-- Custom CSS for Theme Toggle Button & Portal -->
<style>
	.theme-toggle-btn {
		background-color: transparent;
		border: 1px solid #e1e6dc;
		color: #015cb5;
		width: 40px;
		height: 40px;
		border-radius: 50%;
		font-size: 18px;
		cursor: pointer;
		display: inline-flex;
		align-items: center;
		justify-content: center;
		transition: all 300ms ease;
		margin-left: 10px;
	}
	.theme-toggle-btn:hover {
		background-color: #015cb5;
		color: #ffffff;
		border-color: #015cb5;
	}
	body.dark-mode .theme-toggle-btn {
		background-color: transparent;
		border-color: #ffffff;
		color: #ffffff;
	}
    body.dark-mode .theme-toggle-btn:hover {
		background-color: #ffffff;
		color: #171717;
	}

    /* Portal Styles */
    .agent-portal {
        display: flex;
        background-color: #f0f5fb;
    }
    body.dark-mode .agent-portal {
        background-color: var(--dark-color1);
    }

    .portal-sidebar {
        width: 280px;
        background-color: var(--theme-color1);
        color: #fff;
        padding: 20px;
        height: 100vh;
        position: fixed; 
        top: 0;
        left: 0;
        overflow-y: auto;
        padding-top: 155px; /* Pushed down to avoid header */
    }
    body.dark-mode .portal-sidebar {
        background-color: #1e2434;
    }

    .agent-profile {
        text-align: center;
        margin-bottom: 30px;
    }
    .agent-profile img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        border: 3px solid var(--theme-color2);
        margin-bottom: 10px;
    }
    .agent-profile h5 {
        margin: 0;
        font-weight: 600;
        color: #fff;
    }
    .agent-profile p {
        font-size: 14px;
        color: #ccc;
        word-break: break-all;
    }

    .portal-nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .portal-nav li a {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
        transition: all 300ms ease;
        font-weight: 500;
    }
    .portal-nav li a:hover,
    .portal-nav li.active a {
        background-color: var(--theme-color2);
    }
    .portal-nav li a i {
        margin-right: 15px;
        width: 20px;
        text-align: center;
    }

    .portal-content {
        flex: 1;
        padding: 40px;
        margin-left: 280px;
        margin-top: 135px; /* Added margin to clear fixed header */
    }
    
    .portal-card {
        background: #fff;
        border-radius: 8px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.05);
    }
    body.dark-mode .portal-card {
        background-color: var(--dark-color2);
    }
    .portal-card h4 {
        display: flex;
        align-items: center;
        font-size: 20px;
        margin-bottom: 15px;
    }
    .portal-card h4 i {
        font-size: 24px;
        margin-right: 15px;
        color: var(--theme-color2);
    }
    .student-table {
        width: 100%;
        border-collapse: collapse;
    }
    .student-table th, .student-table td {
        padding: 15px;
        border-bottom: 1px solid #eee;
        text-align: left;
    }
    body.dark-mode .student-table th, body.dark-mode .student-table td {
        border-bottom-color: #444;
    }
    .student-table th {
        font-weight: 600;
    }
</style>
</head>
<body>
<div class="page-wrapper">
<!-- Preloader -->
<div class="preloader"></div>
<!-- Main Header-->
<!-- Main Header-->
<header class="main-header header-style-one">
<!-- Header Top -->
<div class="header-top">
<div class="inner-container">
<div class="top-left">
<!-- Info List -->
<ul class="list-style-one">
<li><i class="fa fa-envelope"></i> <a href="mailto:support@kuroeduconsultancy.com">support@kuroeduconsultancy.com</a></li>
<li><i class="fa fa-map-marker"></i> 3rd Floor George Silundika Avenue, Harare</li>
<li><i class="fa fa-clock"></i> Mon_Fri: 8.00 to 16.00</li>
</ul>
</div>
<div class="top-right">
<ul class="useful-links">
<li><a href="#">Help</a></li>
<li><a href="#">Support</a></li>
<li><a href="#">Contact</a></li>
</ul>
</div>
</div>
</div>
<!-- Header Top -->
<!-- Header Lower -->
<div class="header-lower">
<!-- Main box -->
<div class="main-box">
<div class="logo-box">
<div class="logo"><a href="index.html"><img alt="Kuro Logo" src="images/LOGO.png" title=""/></a></div>
</div>
<!--Nav Box-->
<div class="nav-outer">
<nav class="nav main-menu">
<ul class="navigation">
<li><a href="index.html">Home</a></li>
<li><a href="page-country.html">Country</a></li>
<li class="current dropdown"><a href="page-service.html">Visa</a>
<ul>
<li><a href="page-service.html">Visa Grid</a></li>
<li><a href="page-service-details.html">Visa Details</a></li>
</ul>
</li>
<li><a href="page-contact.html">Contact</a></li>
<li><a href="page-about.html">About</a></li>
<li><a href="student-portal.html">Student Portal</a></li>
</ul>
</nav>
<!-- Main Menu End-->
<div class="outer-box">
<a class="info-btn" href="tel:+48783042776">
<img alt="" class="icon" src="images/icons/icon-phone.png"/>
<small>Call Anytime</small>
<strong>+48 783 042 776</strong>
</a>
<div class="ui-btn-outer">
<button class="ui-btn ui-btn search-btn">
<span class="icon lnr lnr-icon-search"></span>
</button>
</div>
<!-- THEME TOGGLE BUTTON ADDED -->
<button class="theme-toggle-btn" id="theme-toggler" title="Toggle Night Mode">
<i class="fa fa-moon"></i>
</button>
<a class="theme-btn btn-style-one" href="https://calendly.com/kuroeducationalconsultancy/30min"><span class="btn-title">Book Consultation</span></a>
<!-- Mobile Nav toggler -->
<div class="mobile-nav-toggler"><span class="icon lnr-icon-bars"></span></div>
</div>
</div>
</div>
</div>
<!-- End Header Lower -->
<!-- Mobile Menu  -->
<div class="mobile-menu">
<div class="menu-backdrop"></div>
<!--Here Menu Will Come Automatically Via Javascript / Same Menu as in Header-->
<nav class="menu-box">
<div class="upper-box">
<div class="nav-logo"><a href="index.html"><img alt="Kuro Logo" src="images/LOGO.png" title=""/></a></div>
<div class="close-btn"><i class="icon fa fa-times"></i></div>
</div>
<ul class="navigation clearfix">
<!--Keep This Empty / Menu will come through Javascript-->
</ul>
<ul class="contact-list-one">
<li>
<!-- Contact Info Box -->
<div class="contact-info-box">
<i class="icon lnr-icon-phone-handset"></i>
<span class="title">Call Now</span>
<a href="tel:+48783042776">+48 783 042 776</a>
</div>
</li>
<li>
<!-- Contact Info Box -->
<div class="contact-info-box">
<span class="icon lnr-icon-envelope1"></span>
<span class="title">Send Email</span>
<a href="mailto:support@kuroeduconsultancy.com">support@kuroeduconsultancy.com</a>
</div>
</li>
<li>
<!-- Contact Info Box -->
<div class="contact-info-box">
<span class="icon lnr-icon-clock"></span>
<span class="title">Send Email</span>
							Mon - Sat 8:00 - 6:30, Sunday - CLOSED
						</div>
</li>
</ul>
<ul class="social-links">
<li><a href="#"><i class="fab fa-twitter"></i></a></li>
<li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
<li><a href="#"><i class="fab fa-pinterest"></i></a></li>
<li><a href="#"><i class="fab fa-instagram"></i></a></li>
</ul>
</nav>
</div><!-- End Mobile Menu -->
<!-- Header Search -->
<div class="search-popup">
<span class="search-back-drop"></span>
<button class="close-search"><span class="fa fa-times"></span></button>
<div class="search-inner">
<form action="index.html" method="post">
<div class="form-group">
<input name="search-field" placeholder="Search..." required="" type="search" value=""/>
<button type="submit"><i class="fa fa-search"></i></button>
</div>
</form>
</div>
</div>
<!-- End Header Search -->
<!-- Sticky Header  -->
<div class="sticky-header">
<div class="auto-container">
<div class="inner-container">
<!--Logo-->
<div class="logo">
<a href="index.html" title=""><img alt="Kuro Logo" src="images/LOGO.png" title=""/></a>
</div>
<!--Right Col-->
<div class="nav-outer">
<!-- Main Menu -->
<nav class="main-menu">
<div class="navbar-collapse show collapse clearfix">
<ul class="navigation clearfix">
<!--Keep This Empty / Menu will come through Javascript-->
</ul>
</div>
</nav><!-- Main Menu End-->
<!--Mobile Navigation Toggler-->
<div class="mobile-nav-toggler"><span class="icon lnr-icon-bars"></span></div>
</div>
</div>
</div>
</div><!-- End Sticky Menu -->
</header>
<!--End Main Header -->
<!-- Agent Portal Section -->
<div class="agent-portal">
<aside class="portal-sidebar">
<div class="agent-profile">
<img alt="Agent Photo" src="https://placehold.co/100x100/015cb5/ffffff?text=Agent"/>
<h5 id="agent-email">Agent</h5>
</div>
<nav class="portal-nav">
<ul>
<li class="active"><a href="#"><i class="fa fa-users"></i> Students</a></li>
<li><a href="#" id="logout-btn"><i class="fa fa-sign-out-alt"></i> Logout</a></li>
</ul>
</nav>
</aside>
<main class="portal-content">
<div class="portal-card">
<h4><i class="fa fa-users"></i> Student List</h4>
<table class="student-table">
<thead>
<tr>
<th>Name</th>
<th>Email</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="student-list-body">
<!-- Student rows will be inserted here by JS -->
</tbody>
</table>
</div>
</main>
</div>
</div><!-- End Page Wrapper -->
<!-- Scroll To Top -->
<div class="scroll-to-top scroll-to-target" data-target="html"><span class="fa fa-angle-up"></span></div>











<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { 
    getAuth, 
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { 
    getFirestore, 
    collection, 
    getDocs 
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBsvSje_UwItSMftbiLVt6Sh1wRR6fF7A0",
    authDomain: "kuroeduportal.firebaseapp.com",
    projectId: "kuroeduportal",
    storageBucket: "gs://kuroeduportal.firebasestorage.app",
    messagingSenderId: "677775001653",
    appId: "1:677775001653:web:8feb2559b811182a52097c",
    measurementId: "G-4JM8RWQDTW"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore(app);

  const logoutBtn = document.getElementById('logout-btn');
  const agentEmail = document.getElementById('agent-email');
  const studentListBody = document.getElementById('student-list-body');
  const allowedAgentEmail = "kuro.agents@kuroeduconsultancy.com";

  onAuthStateChanged(auth, (user) => {
    if (user && user.email === allowedAgentEmail) {
      agentEmail.textContent = user.email;
      fetchStudents();
    } else {
      // If user is not the agent, sign them out and redirect
      signOut(auth);
      window.location.href = 'agent-login.html';
    }
  });

  logoutBtn.addEventListener('click', (e) => {
    e.preventDefault();
    signOut(auth).catch((error) => console.error('Sign out error:', error));
  });

  async function fetchStudents() {
    try {
        const querySnapshot = await getDocs(collection(db, "users"));
        studentListBody.innerHTML = ''; // Clear existing list
        querySnapshot.forEach((doc) => {
            const student = doc.data();
            const studentId = doc.id;
            const row = `
                <tr>
                    <td>${student.name || `${student.firstName || ''} ${student.surname || ''}`}</td>
                    <td>${student.email}</td>
                    <td>
                        <a href="agent-student-details.html?id=${studentId}" class="theme-btn btn-style-one small">View Details</a>
                    </td>
                </tr>
            `;
            studentListBody.innerHTML += row;
        });
    } catch (error) {
        console.error("Error fetching students: ", error);
        studentListBody.innerHTML = '<tr><td colspan="3">Could not load student data.</td></tr>';
    }
  }

</script>
<!-- THEME TOGGLE SCRIPT -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const themeToggler = document.getElementById('theme-toggler');
    const darkThemeStyle = document.getElementById('dark-theme-style');
    const themeIcon = themeToggler ? themeToggler.querySelector('i') : null;

    const setTheme = (isDark) => {
        if (darkThemeStyle) darkThemeStyle.disabled = !isDark;
        document.body.classList.toggle('dark-mode', isDark);
        if (themeIcon) {
            themeIcon.classList.toggle('fa-sun', isDark);
            themeIcon.classList.toggle('fa-moon', !isDark);
        }
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    };

    const savedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (savedTheme === 'dark' || (savedTheme === null && prefersDark)) {
        setTheme(true);
    } else {
        setTheme(false);
    }

    if (themeToggler) {
        themeToggler.addEventListener('click', () => {
            const isDark = darkThemeStyle ? !darkThemeStyle.disabled : document.body.classList.contains('dark-mode');
            setTheme(!isDark);
        });
    }
});
</script>
<script defer="defer" src="https://code.jquery.com/jquery-3.7.1.min.js"></script><script defer="defer" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script><script defer="defer" src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script><script>
    (function(){
      const DB_STUDENTS_KEY = 'kuro_students';
      const CURRENT_USER_KEY = 'kuro_current_user';
      const read = (k, fallback) => {
        try { const v = JSON.parse(localStorage.getItem(k) || 'null'); return v ?? fallback; } catch(e){ return fallback; }
      };
      const write = (k, v) => localStorage.setItem(k, JSON.stringify(v));
      const nowISO = () => new Date().toISOString();
      window._kuro = {
        students: () => read(DB_STUDENTS_KEY, []),
        saveStudents: (arr) => write(DB_STUDENTS_KEY, arr),
        currentUser: () => read(CURRENT_USER_KEY, null),
        login: (type, id, email) => write(CURRENT_USER_KEY, {type, id, email, ts: nowISO()}),
        logout: () => localStorage.removeItem(CURRENT_USER_KEY),
        findStudent: (id) => (read(DB_STUDENTS_KEY, []).find(s => s.id === id) || null),
        upsertStudent: (obj) => {
          const all = read(DB_STUDENTS_KEY, []);
          const idx = all.findIndex(s => s.id === obj.id);
          if (idx >= 0) all[idx] = obj; else all.push(obj);
          write(DB_STUDENTS_KEY, all);
        }
      };
    })();
    
    (function(){
      const user = _kuro.currentUser();
      if (!user || user.type !== 'agent') {
        window.location.href = 'agent-login.html';
        return;
      }
      const tbody = document.getElementById('student-list-body');
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) logoutBtn.addEventListener('click', function(e){ e.preventDefault(); _kuro.logout(); window.location.href = 'agent-login.html'; });
      function render(){
        const students = _kuro.students();
        if (!tbody) return;
        tbody.innerHTML = '';
        if (!students.length){
          const tr = document.createElement('tr');
          const td = document.createElement('td');
          td.colSpan = 3; td.textContent = 'No student records yet.';
          tr.appendChild(td); tbody.appendChild(tr);
          return;
        }
        students.forEach(s => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${s.name || '-'}</td><td>${s.email || '-'}</td>
            <td><a class="btn btn-sm btn-primary" href="agent-student-details.html?id=${encodeURIComponent(s.id)}">View</a></td>`;
          tbody.appendChild(tr);
        });
      }
      render();
    })();
    </script></body>
</html>
